"use strict";(self.webpackChunknuvirlab_dev=self.webpackChunknuvirlab_dev||[]).push([[946],{1686:(e,t,a)=>{a.d(t,{R:()=>n});var s=a(4340),r=a(9004);function n(e,t,a,n){const i=structuredClone(n);(0,s.Q)(e,t,a,n),(0,r.R)(e,t,a,n),n.resetname&&(n.reset=()=>{},t.add(n,"reset").name(n.resetname).onChange((()=>{!function(e,t,a){const n=e.__controllers;a.visiblename&&(0,s.y)(t,n,a);a.labelname&&(0,r.M)(t,n,a)}(t,a,i),e.update()})))}},9004:(e,t,a)=>{a.d(t,{M:()=>i,R:()=>n});var s=a(3848),r=a(9477);function n(e,t,a,s){s.labelname&&t.add(s,"label").name(s.labelname).onFinishChange((e=>{a.getObjectByName("label"+a.name,!0).element.innerText=e})),s.labelColorname&&t.addColor(s,"labelColor").name(s.labelColorname).onChange((e=>{a.getObjectByName("label"+a.name,!0).element.style.color=o(e)})),s.labelVisiblename&&t.add(s,"labelVisible").name(s.labelVisiblename).onChange((t=>{a.getObjectByName("label"+a.name,!0).visible=t,e.update()}))}function i(e,t,a){a.labelname&&((0,s.Zn)(t,"label"),e.getObjectByName("label"+e.name,!0).element.innerText=a.label),a.labelColorname&&((0,s.Zn)(t,"labelColor"),e.getObjectByName("label"+e.name,!0).element.style.color=o(a.labelColor)),a.labelVisiblename&&(e.getObjectByName("label"+e.name,!0).visible=a.labelVisible)}function o(e){let t=new r.Ilk;return t.setHex(e),`rgb(${255*t.r},${255*t.g},${255*t.b})`}},8043:(e,t,a)=>{function s(e){return e.charAt(0).toUpperCase()+e.slice(1)}a.d(t,{f:()=>s})},9167:(e,t,a)=>{a.d(t,{s:()=>n});var s=a(9477),r=a(1098);function n(e,t,a){const n=new s.Kj0(e,t);return a.setXLength&&(n.scale.x=(0,r.v)(a.setXLength)),a.setYLength&&(n.scale.y=(0,r.v)(a.setYLength)),a.setZLength&&(n.scale.z=(0,r.v)(a.setZLength)),n}},3855:(e,t,a)=>{a.d(t,{L:()=>r,x:()=>n});var s=a(1098);function r(e,t){const a=(0,s.A)(t.setTranslation);e.position.set(a.x,a.z,a.y)}function n(e,t){const a=(0,s.A)(t.setTranslation);e.position.set(a.x,a.y,a.z)}},4229:(e,t,a)=>{var s=a(1098),r=a(6898),n=a(2537),i=a(234),o=a(7897),l=a(9477),m=a(5713),c=a(2940);var d=a(5140);var h=a(1779),u=a(3848);var g=a(7833),p=a(4340),b=a(9004);function y(e,t,a,s){const r=t.addFolder(s.name);r.close();const n=structuredClone(s);(0,p.Q)(e,r,a,s);const i=a.geometry.parameters.height,o=a.geometry.parameters.radiusTop,m=a.geometry.parameters.radiusBottom,c=a.geometry.parameters.radiusSegments;s.radiusTop&&r.add(s,"radiusTop",0,e.size).name(s.radiusTopname).listen().onChange((t=>{v(a,t,m,i,c,s.isG4),e.update()})),s.radiusBottom&&r.add(s,"radiusBottom",0,e.size).name(s.radiusBottomname).listen().onChange((t=>{v(a,o,t,i,c,s.isG4),e.update()})),s.height&&r.add(s,"height",0,e.size).name(s.heightname).listen().onChange((t=>{v(a,o,m,t,c,s.isG4),e.update()})),s.radialSegments&&r.add(s,"radialSegments",0,100).name(s.radialSegmentsname).listen().onChange((t=>{v(a,o,m,i,t,s.isG4),e.update()})),(0,h.j)(e,r,a,s),function(e,t,a,s){s.rotXname&&t.add(s,"rotX",0,360).name(s.rotXname).onChange((t=>{a.rotation.x=l.M8C.degToRad(t),e.update()})),s.rotYname&&t.add(s,"rotY",0,360).name(s.rotYname).onChange((t=>{a.rotation.z=l.M8C.degToRad(t),e.update()})),s.rotZname&&t.add(s,"rotZ",0,360).name(s.rotZname).onChange((t=>{a.rotation.y=l.M8C.degToRad(t),e.update()}))}(e,r,a,s),(0,g.s)(e,r,a,s),(0,b.R)(e,r,a,s),s.resetname&&(s.reset=()=>{},r.add(s,"reset").name(s.resetname).onChange((()=>{!function(e,t,a){const s=e.__controllers;a.radiusTop&&((0,u.Zn)(s,"radiusTop"),v(t,a.radiusTop,a.radiusBottom,a.height,a.radialSegments,a.isG4));a.radiusBottom&&((0,u.Zn)(s,"radiusBottom"),v(t,a.radiusTop,a.radiusBottom,a.height,a.radialSegments,a.isG4));a.height&&((0,u.Zn)(s,"height"),v(t,a.radiusTop,a.radiusBottom,a.height,a.radialSegments,a.isG4));a.radialSegments&&((0,u.Zn)(s,"radialSegments"),v(t,a.radiusTop,a.radiusBottom,a.height,a.radialSegments,a.isG4));(0,h.d)(t,s,a),function(e,t,a){a.rotXname&&((0,u.Zn)(t,"rotX"),e.rotation.x=l.M8C.degToRad(a.rotX)),a.rotYname&&((0,u.Zn)(t,"rotY"),e.rotation.z=l.M8C.degToRad(a.rotZ)),a.rotZname&&((0,u.Zn)(t,"rotZ"),e.rotation.y=l.M8C.degToRad(a.rotY)),e.rotation.x=Math.PI/2}(t,s,a),(0,g.V)(t,s,a),(0,p.y)(t,s,a),(0,b.M)(t,s,a)}(r,a,n),e.update()})))}function v(e,t,a,s,r){let n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];e.geometry.dispose(),e.geometry=new l.fHI(t,a,s,r),n&&(e.rotation.x=Math.PI/2)}var R=a(7108),f=a(8043);const w={name:"Cylinder",parent:"world",insert:"cylinder",setMaterial:"Water",setColor:"green",setRmax:"10.0 cm",setHeight:"20. cm",setLabel:!0,setGui:!0};class C extends l.Kj0{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.params={...w,...t},this.name=this.params.name,this.label=this.params.label?this.params.label:this.params.name;let a=(0,f.f)(this.params.setMaterial);this.params.description=`${a} cylinder (radius: ${this.params.setRmax}, height: ${this.params.setHeight})`,(0,R.T)("inforComponents",this.params.description),function(e){const t=e.params;e.material=new l.Wid({color:t.setColor?t.setColor:"aqua",transparent:!0,opacity:.5,depthWrite:!0,wireframe:!1});let a=1,r=1,n=1;t.setRmax&&(a=(0,s.v)(t.setRmax),r=a),t.setHeight&&(n=(0,s.v)(t.setHeight)),t.radius&&(a=(0,s.v)(t.radius),r=a),t.halfz&&(n=2*(0,s.v)(t.halfz)),t.color&&(e.material.color=new l.Ilk(t.color)),e.geometry=new l.fHI(a,r,n)}(this),this.params.setLabel&&function(e){const t=(0,d._)(e.label,1.2*e.geometry.parameters.radiusTop,e.geometry.parameters.height/2);t.name="label"+e.name,e.add(t)}(this),this.params.setGui&&function(e,t){const a=t.gui,s=e.params;let r={name:e.name,isG4:s.isG4,get resetname(){return"Reset "+this.name}},n={};s.guiVisible&&(n={visible:e.visible,visiblename:"Visible"},r={...r,...n});let i={};s.guiGeometry&&(i={height:e.geometry.parameters.height,heightname:"Height (m)",radiusTop:e.geometry.parameters.radiusTop,radiusTopname:"Top radius (m)",radiusBottom:e.geometry.parameters.radiusBottom,radiusBottomname:"Bottom radius (m)"},r={...r,...i});let o={};s.guiPosition&&(o={posX:e.position.x,posXname:"Position X (m)",posY:e.position.y,posYname:"Position Y (m)",posZ:e.position.z,posZname:"Position Z (m)"},r={...r,...o});let l={};s.guiRotation&&(l={rotX:e.rotation.x,rotXname:"Rotation X (deg)",rotY:e.rotation.y,rotYname:"Rotation Y (deg)",rotZ:e.rotation.z,rotZname:"Rotation Z (deg)"},r={...r,...l});let m={};s.guiMaterial&&(m={color:e.material.color.getHex(),colorname:"Color",opacity:e.material.opacity,opacityname:"Opacity",wireframe:e.material.wireframe,wireframename:"Wireframe"},r={...r,...m});let c={};s.guiLabel&&(c={label:e.label,labelname:"Label",labelColor:16777215,labelColorname:"Label color",labelVisible:!0,labelVisiblename:"Label visible"},r={...r,...c}),y(t,a,e,r)}(this,e)}}var x=a(6564);var L=a(9167);function T(e,t,a,s,r,n,i){for(let o=0;o<a;o++)for(let a=0;a<s;a++)for(let s=0;s<r;s++){let r=t.clone();r.position.x=i.x+n.x*o,r.position.y=i.y+n.y*a,r.position.z=i.z+n.z*s,e.add(r)}}var Z=a(3855);function M(e,t,a){const r=new l.ZAu,n=new l.ZAu,i=(0,s.A)(t.setRepeatVector),o=parseInt(t.setRepeatNumberRing),m=(0,s.v)(a.setZLength);T(n,e,1,1,o,i,new l.Pa4(e.position.x,e.position.y,e.position.z-i.z*(o/2)+m/2)),(0,Z.x)(n,a);return function(e,t,a){const s=new l.ZAu;s.add(t);const r=2*Math.PI/a;for(let t=0;t<a;++t){let a=s.clone();a.rotation.z+=r*t,e.add(a)}}(r,n,parseInt(t.setRepeatNumberLine)),r.name="blocks",r}var G=a(4111);function z(e,t,a,s,r){let n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const i=new l.Kj0(e,t);(0,x.wU)(i,{setRmax:r.setRmax,setHeight:r.setHeight});const o=new l.Kj0(a,s);(0,x.wU)(o,{setRmax:r.setRmin,setHeight:r.setHeight});const m=G.yU.fromMesh(i,0),c=G.yU.fromMesh(o,1),d=m.subtract(c),h=G.yU.toMesh(d,new l.yGw);return h.material=i.material,n&&(h.rotation.x=Math.PI/2),h}function Y(e){const t=e.params;e.name=t.name;const a=function(e){const t=e.setColor?e.setColor:"white",a=new l.Wid({color:t,transparent:!0,opacity:.5,depthWrite:!0,wireframe:!0}),s=e.setColor?e.setColor:"yellow";return{air:a,BGO:new l.Wid({color:s,transparent:!0,opacity:.5,depthWrite:!0,wireframe:!1}),tungsten:new l.Wid({color:e.carter1.setColor,transparent:!0,opacity:1,depthWrite:!0,wireframe:!1})}}(t),r={box:new l.DvJ(1,1,1),cylinder:new l.fHI(1,1,1,100)},n=function(e,t){const a=new l.ZAu,s=(0,x.Y)({setRmax:t.setRmin,setHeight:t.setHeight,radialSegments:100,openEnded:!0},e),r=(0,x.Y)({setRmax:t.setRmax,setHeight:t.setHeight,radialSegments:100,openEnded:!0},e);return a.add(s,r),t.isG4&&(a.rotation.x=Math.PI/2),a.name="container",a}(a.air,t);n.visible=!1;const i=function(e,t,a){const r=new l.ZAu,n=(0,L.s)(e.box,t.BGO,a.crystal),i=(0,L.s)(e.box,t.air,a.block),o=(0,s.A)(a.cubicArray.setRepeatVector),m=parseInt(a.cubicArray.setRepeatNumberX),c=parseInt(a.cubicArray.setRepeatNumberY),d=parseInt(a.cubicArray.setRepeatNumberZ),h=(0,s.v)(a.crystal.setYLength),u=(0,s.v)(a.crystal.setZLength),g=(0,s.v)(a.block.setYLength),p=(0,s.v)(a.block.setZLength);return T(r,n,m,c,d,o,new l.Pa4(0,-g/2+h/2,-p/2+u/2)),r.add(i),r}(r,a,t),o=M(i,t.linear,t.block),m=function(e,t,a){const s=new l.ZAu,r=(z(e.cylinder,t.air,e.cylinder,t.air,a.carter,a.isG4),z(e.cylinder,t.tungsten,e.cylinder,t.air,a.carter1,a.isG4));(0,Z.x)(r,a.carter1),s.add(r);const n=z(e.cylinder,t.tungsten,e.cylinder,t.air,a.carter2,a.isG4);(0,Z.x)(n,a.carter2),s.add(n);const i=z(e.cylinder,t.tungsten,e.cylinder,t.air,a.carter3,a.isG4);(0,Z.x)(i,a.carter3),s.add(i);const o=z(e.cylinder,t.tungsten,e.cylinder,t.air,a.carter4,a.isG4);return(0,Z.x)(o,a.carter4),s.add(o),(0,Z.x)(s,a.carter),s.name=a.carter.name,s}(r,a,t);return{materials:a,rings:o,carters:m}}var B=a(4827),H=a(9559),P=a(1686);const k={name:"ecat",label:"PET scanner",insert:"cylinder",setMaterial:"Air",setRmax:"44.2 cm",setRmin:"41.2 cm",radialSegments:"2",setHeight:"15.52 cm",setVisible:"1",setLabel:!0,setGui:!0,isG4:!0,block:{name:"block",insert:"box",setTranslation:"427.0 0.0 0.0 mm",setXLength:"30.0 mm",setYLength:"35.8594 mm",setZLength:"38.7 mm",setMaterial:"Air"},crystal:{name:"crystal",insert:"box",setXLength:"30.0 mm",setYLength:"4.4 mm",setZLength:"4.75 mm",setMaterial:"BGO",setColor:"yellow"},cubicArray:{insert:"cubicArray",setRepeatNumberX:"1",setRepeatNumberY:"8",setRepeatNumberZ:"8",setRepeatVector:"0. 4.4942 4.85 mm"},linear:{insert:"linear",setRepeatNumberRing:"4",setRepeatVector:"0. 0. 38.8 mm",insert:"ring",setRepeatNumberLine:"72"},carter:{name:"carter",label:"Carter",insert:"cylinder",setMaterial:"Air",setRmax:"44.  cm",setRmin:"28.  cm",setHeight:"9. cm",setTranslation:"0.0 0.0 12.5 cm"},carter1:{name:"carter1",insert:"cylinder",setMaterial:"Tungsten",setRmax:"30.0  cm",setRmin:"29.0  cm",setHeight:"3.0 cm",setColor:"grey",setTranslation:"0.0 0.0 -3 cm"},carter2:{name:"carter2",insert:"cylinder",setMaterial:"Tungsten",setRmax:"40.7  cm",setRmin:"30.0  cm",setHeight:"1.0 cm",setColor:"grey",setTranslation:"0.0 0.0 -2 cm"},carter3:{name:"carter3",insert:"cylinder",setMaterial:"Tungsten",setRmax:"40.7  cm",setRmin:"39.7  cm",setHeight:"3.0 cm",setColor:"grey",setTranslation:"0.0 0.0 0 cm"},carter4:{name:"carter4",insert:"cylinder",setMaterial:"Tungsten",setRmax:"43.7  cm",setRmin:"40.7  cm",setHeight:"1.0 cm",setColor:"grey",setTranslation:"0.0 0.0 1 cm"}};class A extends l.ZAu{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.params={...k,...t},this.labels=[],this.label=t.label,this.params.description="Ecat PET",(0,R.T)("inforComponents",this.params.description),this.meshes=Y(this),this.add(this.meshes.rings,this.meshes.carters),this.params.setLabel&&function(e){e.params;const t=(0,s.v)(e.params.setRmax),a=(0,s.v)(e.params.setHeight),r=(0,d._)(e.params.label,0,1.2*t,-a);r.name="label"+e.name,e.add(r),e.labels.push(e.params.label)}(this),this.params.setGui&&function(e,t){const a=t.gui.addFolder("PET"),s={name:"PET rings",visible:e.visible,visiblename:"Visible",label:e.params.label,labelname:"Label",labelColor:16777215,labelColorname:"Label color",labelVisible:!0,labelVisiblename:"Label visible",get resetname(){return"Reset "+this.name}};(0,P.R)(t,a,e,s);const r=(0,H.J)(e,"blocks"),n=e.params.crystal.setMaterial,i=e.meshes.materials[n].opacity,o={name:"Crystal blocks",visible:r.visible,visiblename:"Visible",opacity:i,opacityname:"Opacity",resetname:"Reset blocks"};(0,B.w)(t,a,r,o);const l=(0,H.J)(e,"carter"),m={name:"Carter",visible:l.visible,visiblename:"Visible",opacity:l.children[0].material.opacity,opacityname:"Opacity",resetname:"Reset carter"};(0,B.w)(t,a,l,m)}(this,e)}}var X=a(372),I=a(7263);var V=a(1494),S=a(1480);const O={description:"Simulation: Positron Emission Tomography (PET) System",infors:{authors:["Trang Hoang"],data:"https://drive.google.com/file/d/1EMIG5sYL2eHw3CbK8SX5BfjL34P4yp0g/view?usp=drive_link",refs:{"SARRUT David, Gate exercices, 7_pet":"https://gitlab.in2p3.fr/davidsarrut/gate-exercices/-/tree/master/7_pet"}},color:6316128,setLabel:!0,setGui:!0,showInfor:!0,world:{setMaterial:"Air",setXLength:"4. m",setYLength:"4. m",setZLength:"4. m"},phantom:{name:"Phantom",label:"Phantom",parent:"world",insert:"cylinder",setMaterial:"Water",setColor:"green",setRmax:"10.0 cm",setHeight:"20. cm",isG4:!0,setGui:!0,guiVisible:!0,guiGeometry:!1,guiPosition:!1,guiRotation:!1,guiMaterial:!0,guiLabel:!0},source:{shape:"cylinder",radius:"0.5 mm",halfz:"0.5 mm",centre:"0.0 0.0 0. cm",color:"yellow",setGui:!1,isG4:!0}};class E extends l.ZAu{constructor(e,t,a){super(),this.params={...O,...a},this.size=e,this.gui=t,this.axis=!0,this.meshes=function(e){const t=e.size,a=new C(e,e.params.phantom);a.rotation.x=Math.PI/2;const s=new A(e),r=(0,m.q)(t/2,"m",t/2e3,e.axis);return r.visible=!1,{phantom:a,pet:s,axes:r,beam:(0,c.I)()}}(this),this.add(this.meshes.axes,this.meshes.phantom,this.meshes.pet,this.meshes.beam),this.runs=[],this.zoomscale=.7,this.rotation.set(Math.PI/12,-Math.PI/6,0),this.params.setGui&&function(e){const t=e.gui,a={name:"World",rotX:l.M8C.radToDeg(e.rotation.x),rotXname:"Rotation X",rotY:l.M8C.radToDeg(e.rotation.y),rotYname:"Rotation Y",rotZ:l.M8C.radToDeg(e.rotation.z),rotZname:"Rotation Z",bgColor:e.params.color,bgColorname:"Background",resetname:"Reset World"};(0,X.O)(e,t,e,a);const s=e.meshes.axes,r={name:"Axes",visible:s.visible,visiblename:"Visible"};(0,I.W)(e,t,s,r)}(this)}setBackgroundColor(){}update(){}zoom(e){}tick(e){}async init(){this.setBackgroundColor(this.params.color),this.zoom(this.zoomscale),(0,V.$)(this,this.params.showInfor),await(0,S.J)(this)}}var N=a(6688),W=a(2036),j=a(1431),_=a(8925),U=a(717);let $,D,K,J,q,F,Q,ee,te=0;class ae{constructor(e){this.worldParams={setXLength:O.world.setXLength,setYLength:O.world.setYLength,setZLength:O.world.setZLength},Object.keys(this.worldParams).forEach((e=>{if(e.includes("Length")){let t=(0,s.v)(this.worldParams[e]);te<t&&(te=t)}})),$=(0,r.d)(0,0,te),J=(0,i.a)(),D=(0,W.U)(),K=(0,j.c)(),Q=(0,o.k)(),q=new U.r($,J,D,K),e.append(D.domElement,K.domElement),F=(0,N.W)($,K.domElement),ee=new E(te,Q,this.worldParams),(0,n.Wc)($,10,10,10,"white",3),q.updatables.push(F),J.add($,ee),ee.setBackgroundColor=e=>{J.background=new l.Ilk(e),this.render()},ee.zoom=e=>{$.position.z*=e,this.render()},ee.update=()=>{this.render()};new _.w(e,$,D,K).onResize=()=>{this.render()},F.addEventListener("change",(()=>{this.render()}))}render(){D.render(J,$),K.render(J,$)}start(){q.start()}stop(){q.stop()}async init(){await ee.init()}}a(4760),"loading"==document.readyState?document.addEventListener("DOMContentLoaded",ready):async function(){const e=document.querySelector("#scene-container");e.style.display="block";const t=new ae(e);await t.init(),t.render()}().catch((e=>{console.log(e)}))},4760:(e,t,a)=>{a.r(t)}},e=>{e.O(0,[395,464],(()=>{return t=4229,e(e.s=t);var t}));e.O()}]);